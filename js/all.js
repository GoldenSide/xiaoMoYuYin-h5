!function(t){function e(){}$.extend(e.prototype,{init:function(t){this.json=JSON.parse(t),$("#result").val(this.json.text),this.choose()},choose:function(){"weather"===this.json.service?this.weather():"music"===this.json.service?this.music():this.other()},weather:function(){if("QUERY"===this.json.operation){var t=this.json.semantic.slots.location.city+(this.json.semantic.slots.location.area?this.json.semantic.slots.location.city:""),e=this.json.semantic.slots.datetime.date;t="CURRENT_CITY"===t?this.json.data.result[0].city:t,e="CURRENT_DAY"===e?this.getDateStr(new Date):e;var i=new M;i.weatherM(t,e)}},music:function(){if("PLAY"===this.json.operation)if(this.json.semantic.slots){var t=new M;t.musicM({artist:this.json.semantic.slots.artist?this.json.semantic.slots.artist:"",song:this.json.semantic.slots.song?this.json.semantic.slots.song:""})}else;},other:function(){var t=this;$.post("http://www.tuling123.com/openapi/api",{key:"e55af5c0aa81408094675bd32a66dcc6",info:t.json.text,loc:"北京市",userid:" 123456"},function(t){$("#content").html(t.text)})},getDateStr:function(t){return t.getFullYear()+"-"+this.add0(t.getMonth())+"-"+this.add0(t.getDate())+"-"},add0:function(t){return t<10?"0"+t:""+t}}),t.understandResultJson=function(t){var i=new e;i.init(t)}}(window);var j={webPage:{header:"",url:"http://kcbj.openspeech.cn/service/iss?wuuid=2654fe7dc204e763e9ce2cc1bd5e5100&ver=2.0&method=webPage&uuid=e5f5320121ec870a37ebea7ad92cf75cquery"},semantic:{slots:{location:{type:"LOC_POI",city:"CURRENT_CITY",poi:"CURRENT_POI"},datetime:{date:"CURRENT_DAY",type:"DT_BASIC"}}},rc:0,operation:"QUERY",service:"weather",data:{result:[{airQuality:"重污染",sourceName:"中国天气网",date:"2017-01-03",lastUpdateTime:"2017-01-03 18:00:09",dateLong:1483372800,pm25:"295",city:"北京",humidity:"67%",windLevel:0,weather:"霾",tempRange:"-5℃",wind:"南风微风"},{airQuality:"",sourceName:"中国天气网",date:"2017-01-04",lastUpdateTime:"2017-01-03 18:00:09",city:"北京",dateLong:1483459200,windLevel:0,weather:"霾",tempRange:"-5℃~7℃",wind:"南风微风"},{airQuality:"",sourceName:"中国天气网",date:"2017-01-05",lastUpdateTime:"2017-01-03 18:00:09",city:"北京",dateLong:1483545600,windLevel:0,weather:"霾",tempRange:"-4℃~5℃",wind:"无持续风向微风"},{airQuality:"",sourceName:"中国天气网",date:"2017-01-06",lastUpdateTime:"2017-01-03 18:00:09",city:"北京",dateLong:1483632e3,windLevel:0,weather:"霾",tempRange:"-2℃~5℃",wind:"南风微风"},{airQuality:"",sourceName:"中国天气网",date:"2017-01-07",lastUpdateTime:"2017-01-03 18:00:09",city:"北京",dateLong:1483718400,windLevel:0,weather:"霾",tempRange:"-3℃~3℃",wind:"南风微风"},{airQuality:"",sourceName:"中国天气网",date:"2017-01-08",lastUpdateTime:"2017-01-03 18:00:09",city:"北京",dateLong:1483804800,windLevel:0,weather:"多云转晴",tempRange:"-4℃~3℃",wind:"南风微风"},{airQuality:"",sourceName:"中国天气网",date:"2017-01-09",lastUpdateTime:"2017-01-03 18:00:09",city:"北京",dateLong:1483891200,windLevel:1,weather:"晴",tempRange:"-6℃~2℃",wind:"北风3-4级"}]},text:"天气"};!function(t){function e(){this.li=null,this.a=null,this.isMove=!1,this.isChange=!1}$.extend(e.prototype,{weatherM:function(t,e){var i=this;$.ajax({url:"http://route.showapi.com/9-2",data:{area:t,showapi_appid:"28554",showapi_sign:"0b31e5ac70e2490599af87a4a5b22f35"},dataType:"json",success:function(s){i.weatherSucc(t,e,s)}})},weatherSucc:function(t,e,i){this.weatherData(i),$("#wrapCss").attr("href","css/weather.css");t+e+i.showapi_res_body.f1.tq;this.creatHtml("../htm/tq.html","html",i,function(){})},weatherData:function(t){var e=new Date;t.date="今天 "+e.getFullYear()+"-"+this.add0(e.getMonth()+1)+"-"+this.add0(e.getDate());var i=["星期天","星期一","星期二","星期三","星期四","星期五","星期六"],s=e.getDay(),a=[t.showapi_res_body.f1,t.showapi_res_body.f2,t.showapi_res_body.f3];a.forEach(function(t,e){t.tq=t.day_weather===t.night_weather?t.day_weather:t.day_weather+"转"+t.night_weather,t.xq=i[s+e]});var n=t.showapi_res_body.time;t.showapi_res_body.time="发布时间："+n.substr(0,4)+"-"+n.substr(4,2)+"-"+n.substr(6,2)+" "+ +n.substr(8,2)+"："+n.substr(10,2)+"："+n.substr(12,2)},musicM:function(t){var e=this;$.ajax({url:"http://route.showapi.com/213-1",data:{keyword:t.artist+t.song,showapi_appid:"28554",showapi_sign:"0b31e5ac70e2490599af87a4a5b22f35",page:"2"},dataType:"json",success:function(t){console.log(t),0!==t.showapi_res_code?alert("出错了"):e.musicSucc(t)}})},musicSucc:function(t){var e=this;$("#wrapCss").attr("href","css/music.css");this.creatHtml("../htm/music.html","html",t,function(){e.musicEvent()})},musicEvent:function(){var t=this;this.li=$(".songList li").eq(0),this.a=$("#musicAudio")[0],this.changeMusic(),$(".songList li").on("touchstart",function(e){t.start(e)})},start:function(t){var e=this;this.isMove=!1,this.isChange=!1;var i="LI"===t.target.tagName?$(t.target):$(t.target).closest("li");this.li.attr("index")!=i.attr("index")&&(this.isChange=!0,this.li=i),this.init={sx:t.targetTouches[0].pageX,sy:t.targetTouches[0].pageY},this.li.addClass("hover"),this.li.on("touchmove",function(t){e.move(t)}),this.li.on("touchend",function(t){e.end(t)}),t.stopPropagation()},move:function(t){var e={sx:t.targetTouches[0].pageX,sy:t.targetTouches[0].pageY};Math.pow(this.init.sx-e.sx,2)+Math.pow(this.init.sy-e.sy,2)>10&&(this.isMove=!0,this.li.removeClass("hover"))},end:function(t){this.isMove||(this.li.removeClass("hover"),this.isChange?($(".songList").find("li").removeClass("active"),this.a.pause(),this.changeMusic()):this.a.paused?this.changeMusic():(this.li.removeClass("active"),this.a.pause())),this.li.off("touchmove"),this.li.off("touchend"),this.li.removeClass("hover")},changeMusic:function(){var t=this;this.li.addClass("active"),this.a.setAttribute("src",this.li.attr("src")),this.a.play(),$(this.a).off("timeupdate").on("timeupdate",function(){t.timedate()}),$(this.a).off("progress").on("progress",function(){t.progress()})},timedate:function(){function t(t){return e.add0(parseInt(t/60))+":"+e.add0(parseInt(t%60))}var e=this;this.li.find(".now").html(t(this.a.currentTime)+"/"+t(this.a.duration)),this.li.find(".playing").width(this.a.currentTime/this.a.duration*this.li.find(".progress").width())},progress:function(){this.a.buffered.length&&this.li.find(".buffer").width(this.a.buffered.end(0)/this.a.duration*this.li.find(".progress").width())},add0:function(t){return t>10?""+t:"0"+t},creatHtml:function(t,e,i,s){$.ajax({url:t,dataType:e,success:function(t){$("#temp").html(t);var e=template("temp",i);$("#content").html(e),s&&s()}})}}),t.M=e}(window);